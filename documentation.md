# Documentation

The DARIAH-DE status page is generated by [Jekyll](https://jekyllrb.com/).

## The infrastructure and its components

The DARIAH-DE infrastructure is modeled using [Jekyll Collections](https://jekyllrb.com/docs/collections/).
The model uses four layers:

1. Services
2. Middlewares
3. Servers
4. Infrastructure

Any item is described by a collection entry with the following metadata preamble.

```yaml
---
title: 'Item Title for display'
description: 'This is a sample entry'
website: 'http://item.url/'
teresah_included: true
dependencies:
  - '/infrastructure/otheritem'
  - '/servers/machine'
---
```

The `title` is required for all entries and used in status messages, for servers this should be the `fqdn`.

The fields `description` and `website` are used for the entries in the list harvested by teresah. The key `teresah_included` defaults to `true` for services, unless explicity set to `false`.

The `dependencies` must be stated using the `id` of the collection entry, i.e. `/:collection/:name` where `:collection` is the name of the collection and `:name` if the filename without extension of the entry.
Dependency cycles, i.e. circular dependencies, are not allowed[^1].

[^1]: Limiting recursion depth doesn't help, as than by the current design all services connected to the cycle would be affected by any outage.

The full list of all resolved dependencies can be found [here](fulllist.html).

## Outages and Announcements

All service disruptions and announcements are registered in [Jekyll Data Files](https://jekyllrb.com/docs/datafiles/). 

```yaml
---
- title: 'This is the heading on the status page'
  description: 'This describes what the entry is about.'
  affected:
    - '/infrastructure/otheritem'
    - '/servers/machine'
```

Using [Liquid](https://shopify.github.io/liquid/) processing, all services depending on any (or listed as) item in the `affected` array are shown on the status page. The array items use the same `id` schema as the infrastructure components dependencies.

Please note, that cycles in the dependencies will result in a

```
Liquid Exception: Liquid error: Nesting too deep
```

## TERESAH

The DARIAH-DE Status Jekyll page also includes the page with all DARIAH-DE services to be harvested by TERESAH.
This includes all services except those explicitly excluded and all middlewares that are explicitly included, as long they have a `title`, `description` and `website` element.

